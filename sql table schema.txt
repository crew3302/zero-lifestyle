-- Drop tables in reverse order of dependency if they exist
DROP TABLE IF EXISTS order_items;
DROP TABLE IF EXISTS orders;
DROP TABLE IF EXISTS products;

-- Products Table
CREATE TABLE products (
  id VARCHAR(255) NOT NULL,
  name VARCHAR(255) NOT NULL,
  description TEXT,
  image_url TEXT,
  category VARCHAR(100),
  sub_category VARCHAR(100), -- For 'Hot', 'New', 'Latest'
  original_price DECIMAL(10, 2) NOT NULL,
  sale_price DECIMAL(10, 2),
  rating DECIMAL(2, 1),
  badge VARCHAR(100),
  colors JSON, -- MySQL 5.7.8+ supports JSON type. For older versions, use TEXT and handle parsing in app.
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Orders Table
CREATE TABLE orders (
  order_id INT AUTO_INCREMENT,
  customer_name VARCHAR(255) NOT NULL,
  customer_email VARCHAR(255) NOT NULL,
  customer_phone VARCHAR(50),
  shipping_address TEXT NOT NULL,
  total_amount DECIMAL(10, 2) NOT NULL,
  status VARCHAR(50) DEFAULT 'Pending', -- e.g., Pending, Processing, Shipped, Delivered, Cancelled
  order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (order_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Order Items Table
CREATE TABLE order_items (
  order_item_id INT AUTO_INCREMENT,
  order_id INT NOT NULL,
  product_id VARCHAR(255) NOT NULL,
  quantity INT NOT NULL,
  price_at_purchase DECIMAL(10, 2) NOT NULL, -- Price of the single item at the time of purchase
  product_name VARCHAR(255), -- Store product name for easier order review
  product_image_url TEXT, -- Store image URL for easier order review
  PRIMARY KEY (order_item_id),
  FOREIGN KEY (order_id) REFERENCES orders(order_id) ON DELETE CASCADE,
  -- Note: For product_id, if it must exist in the products table, add a FOREIGN KEY:
  -- FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE RESTRICT (or SET NULL, or CASCADE depending on desired behavior)
  -- For now, I'm omitting strict FK to products to allow flexibility if product IDs could be external.
  -- If all products MUST be in your products table, uncomment and adjust the ON DELETE rule.
  INDEX idx_order_items_order_id (order_id),
  INDEX idx_order_items_product_id (product_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;